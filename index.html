// Set initial volume
        audioPlayer.volume = 0.7;<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Music Player</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #000;
            color: #fff;
            font-family: 'Arial', sans-serif;
            overflow-x: hidden;
            min-height: 100vh;
        }

        /* Animated starfield background */
        .starfield {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
        }

        .star {
            position: absolute;
            background: #4a9eff;
            border-radius: 50%;
            animation: twinkle 3s infinite alternate;
        }

        @keyframes twinkle {
            0% { opacity: 0.3; transform: scale(1); }
            100% { opacity: 1; transform: scale(1.2); }
        }

        .constellation {
            position: absolute;
            width: 2px;
            height: 2px;
            background: #4a9eff;
            border-radius: 50%;
            box-shadow: 0 0 10px #4a9eff;
        }

        /* Constellation lines */
        .constellation-line {
            position: absolute;
            height: 1px;
            background: linear-gradient(90deg, transparent, #4a9eff, transparent);
            opacity: 0.3;
            animation: pulse 4s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.2; }
            50% { opacity: 0.6; }
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 1;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .title {
            font-size: 3rem;
            background: linear-gradient(45deg, #4a9eff, #00d4ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
            text-shadow: 0 0 20px rgba(74, 158, 255, 0.3);
        }

        .search-container {
            margin-bottom: 30px;
            display: flex;
            justify-content: center;
        }

        .search-input {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(74, 158, 255, 0.3);
            color: #fff;
            padding: 12px 20px;
            border-radius: 25px;
            width: 300px;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
            outline: none;
        }

        .search-input:focus {
            border-color: #4a9eff;
            box-shadow: 0 0 20px rgba(74, 158, 255, 0.3);
            transform: scale(1.02);
        }

        .search-input::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        .playlists {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .playlist-card {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(74, 158, 255, 0.3);
            border-radius: 15px;
            padding: 20px;
            backdrop-filter: blur(15px);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .playlist-card:hover {
            transform: translateY(-5px);
            border-color: #4a9eff;
            box-shadow: 0 10px 30px rgba(74, 158, 255, 0.2);
        }

        .playlist-title {
            font-size: 1.2rem;
            margin-bottom: 10px;
            color: #4a9eff;
        }

        .song-list {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 120px; /* Space for fixed player */
            backdrop-filter: blur(10px);
            max-height: 60vh;
            overflow-y: auto;
        }

        .song-list::-webkit-scrollbar {
            width: 8px;
        }

        .song-list::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
        }

        .song-list::-webkit-scrollbar-thumb {
            background: rgba(74, 158, 255, 0.5);
            border-radius: 4px;
            transition: background 0.3s ease;
        }

        .song-list::-webkit-scrollbar-thumb:hover {
            background: rgba(74, 158, 255, 0.8);
        }

        .song-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 5px;
            transition: all 0.3s ease;
            cursor: pointer;
            border: 1px solid transparent;
        }

        .song-item:hover {
            background: rgba(74, 158, 255, 0.15);
            transform: translateX(5px);
            border-color: rgba(74, 158, 255, 0.3);
        }

        .song-item.active {
            background: rgba(74, 158, 255, 0.25);
            border-color: #4a9eff;
            transform: translateX(5px);
        }

        .song-item.active .song-name {
            color: #4a9eff;
            font-weight: bold;
        }

        .song-info {
            display: flex;
            flex-direction: column;
            flex-grow: 1;
            min-width: 0;
        }

        .song-name {
            font-size: 1rem;
            margin-bottom: 4px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .song-artist {
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.6);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .song-duration {
            color: rgba(255, 255, 255, 0.6);
            margin-left: 10px;
        }

        .player {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.9);
            border-top: 1px solid rgba(74, 158, 255, 0.3);
            padding: 20px;
            backdrop-filter: blur(20px);
            z-index: 100;
        }

        .player-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .current-song {
            flex-grow: 1;
            min-width: 0;
        }

        .current-song-title {
            font-weight: bold;
            color: #4a9eff;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .current-playlist {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.6);
        }

        .progress-container {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 5px;
        }

        .progress-bar {
            flex-grow: 1;
            height: 4px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 2px;
            cursor: pointer;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4a9eff, #00d4ff);
            border-radius: 2px;
            width: 0%;
            transition: width 0.1s ease;
        }

        .time-display {
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.6);
            min-width: 40px;
        }

        .controls {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .control-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(74, 158, 255, 0.3);
            color: #fff;
            padding: 12px 16px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            min-width: 45px;
            min-height: 45px;
        }

        .control-btn:hover {
            background: rgba(74, 158, 255, 0.2);
            border-color: #4a9eff;
            transform: scale(1.1);
            box-shadow: 0 4px 15px rgba(74, 158, 255, 0.3);
        }

        .control-btn:active {
            transform: scale(0.95);
        }

        .control-btn.play-pause {
            min-width: 55px;
            min-height: 55px;
            font-size: 1.2rem;
        }

        .shuffle-btn.active {
            background: rgba(74, 158, 255, 0.3);
            border-color: #4a9eff;
            box-shadow: 0 0 15px rgba(74, 158, 255, 0.4);
        }

        /* Button icons using CSS */
        .btn-icon {
            width: 16px;
            height: 16px;
            position: relative;
        }

        .play-icon::before {
            content: '';
            position: absolute;
            width: 0;
            height: 0;
            border-left: 12px solid #fff;
            border-top: 8px solid transparent;
            border-bottom: 8px solid transparent;
            left: 2px;
            top: 0;
        }

        .pause-icon::before,
        .pause-icon::after {
            content: '';
            position: absolute;
            width: 4px;
            height: 16px;
            background: #fff;
            top: 0;
        }

        .pause-icon::before {
            left: 3px;
        }

        .pause-icon::after {
            right: 3px;
        }

        .prev-icon::before,
        .next-icon::before {
            content: '';
            position: absolute;
            width: 0;
            height: 0;
            border-top: 6px solid transparent;
            border-bottom: 6px solid transparent;
            top: 2px;
        }

        .prev-icon::before {
            border-right: 8px solid #fff;
            left: 6px;
        }

        .prev-icon::after {
            content: '';
            position: absolute;
            width: 2px;
            height: 12px;
            background: #fff;
            left: 2px;
            top: 2px;
        }

        .next-icon::before {
            border-left: 8px solid #fff;
            right: 6px;
        }

        .next-icon::after {
            content: '';
            position: absolute;
            width: 2px;
            height: 12px;
            background: #fff;
            right: 2px;
            top: 2px;
        }

        .shuffle-icon {
            font-size: 14px;
            font-weight: bold;
        }

        .volume-control {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .volume-slider {
            width: 80px;
            accent-color: #4a9eff;
        }

        .hidden {
            display: none;
        }

        /* Responsive design */
        @media (max-width: 768px) {
            .player-content {
                flex-direction: column;
                gap: 15px;
            }
            
            .controls {
                gap: 10px;
            }
            
            .control-btn {
                padding: 8px 12px;
                min-width: 40px;
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <div class="starfield" id="starfield"></div>
    
    <div class="container">
        <div class="header">
            <h1 class="title">üåü Music Player üåü</h1>
        </div>

        <div class="search-container">
            <input type="text" class="search-input" placeholder="Search for songs..." id="searchInput">
        </div>

        <div class="playlists" id="playlists">
            <!-- Playlists will be loaded dynamically -->
        </div>

        <div class="song-list hidden" id="songList">
            <h3 id="currentPlaylistTitle">Songs</h3>
            <div id="songItems"></div>
        </div>
    </div>

    <div class="player" id="player">
        <div class="player-content">
            <div class="current-song">
                <div class="current-song-title" id="currentSongTitle">No song selected</div>
                <div class="current-playlist" id="currentPlaylistName">Select a playlist to start</div>
                <div class="progress-container">
                    <span class="time-display" id="currentTime">0:00</span>
                    <div class="progress-bar" id="progressBar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                    <span class="time-display" id="totalTime">0:00</span>
                </div>
            </div>
            
            <div class="controls">
                <button class="control-btn shuffle-btn" id="shuffleBtn">
                    <span class="shuffle-icon">‚§Æ</span>
                </button>
                <button class="control-btn" id="prevBtn">
                    <span class="btn-icon prev-icon"></span>
                </button>
                <button class="control-btn play-pause" id="playPauseBtn">
                    <span class="btn-icon play-icon" id="playPauseIcon"></span>
                </button>
                <button class="control-btn" id="nextBtn">
                    <span class="btn-icon next-icon"></span>
                </button>
                <div class="volume-control">
                    <span style="font-size: 1.2rem;">üîä</span>
                    <input type="range" class="volume-slider" id="volumeSlider" min="0" max="100" value="70">
                </div>
            </div>
        </div>
    </div>

    <audio id="audioPlayer" preload="metadata"></audio>

    <script>
        // Music player state
        let currentPlaylist = [];
        let currentSongIndex = 0;
        let isPlaying = false;
        let isShuffled = false;
        let originalPlaylist = [];
        let currentPlaylistName = '';
        let discoveredPlaylists = {};

        // DOM elements
        const audioPlayer = document.getElementById('audioPlayer');
        const playPauseBtn = document.getElementById('playPauseBtn');
        const playPauseIcon = document.getElementById('playPauseIcon');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const shuffleBtn = document.getElementById('shuffleBtn');
        const progressBar = document.getElementById('progressBar');
        const progressFill = document.getElementById('progressFill');
        const currentTime = document.getElementById('currentTime');
        const totalTime = document.getElementById('totalTime');
        const currentSongTitle = document.getElementById('currentSongTitle');
        const currentPlaylistNameEl = document.getElementById('currentPlaylistName');
        const volumeSlider = document.getElementById('volumeSlider');
        const searchInput = document.getElementById('searchInput');
        const songList = document.getElementById('songList');
        const songItems = document.getElementById('songItems');
        const playlistCards = document.querySelectorAll('.playlist-card');

        // Function to discover playlist folders in the music directory
        async function discoverPlaylistFolders() {
            const potentialFolders = [
                // Original playlists
                'Taysavie Liked Songs',
                'Lil peep and Xxxtentacion', 
                'Xxxtentacion Songs for sleeping',
                
                // Common playlist folder names to try
                'Hip Hop', 'Rap', 'Pop', 'Rock', 'Electronic', 'Chill', 'Favorites',
                'Liked Songs', 'My Music', 'Playlist 1', 'Playlist 2', 'Playlist 3',
                'New Music', 'Top Hits', 'Classics', 'Party', 'Study', 'Workout',
                'Sleep', 'Relax', 'Focus', 'Mood', 'Vibes', 'Mix', 'Collection',
                
                // Artist-based folders
                'Lil Peep', 'XXXTentacion', 'Juice WRLD', 'Post Malone', 'Drake',
                'Travis Scott', 'Kanye West', 'Eminem', 'Kendrick Lamar',
                
                // Genre folders
                'Trap', 'Lo-Fi', 'Indie', 'Alternative', 'Jazz', 'Blues', 'Country',
                'Reggae', 'Punk', 'Metal', 'Classical', 'Ambient', 'House', 'Techno',
                
                // Year-based
                '2024', '2023', '2022', '2021', '2020', '2019', '2018',
                
                // Simple names
                'A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J',
                '1', '2', '3', '4', '5', '6', '7', '8', '9', '10',
                
                // Common folder patterns
                'folder1', 'folder2', 'folder3', 'music1', 'music2', 'songs1', 'songs2'
            ];
            
            const foundFolders = [];
            
            for (const folderName of potentialFolders) {
                try {
                    // Test if folder exists by trying to access a common file pattern
                    const testResponse = await fetch(`music/${encodeURIComponent(folderName)}/1.mp3`, { 
                        method: 'HEAD',
                        cache: 'no-cache'
                    });
                    
                    if (testResponse.status === 200) {
                        foundFolders.push(folderName);
                        continue;
                    }
                    
                    // If 1.mp3 doesn't exist, try other common patterns to see if folder exists
                    const commonFiles = ['01.mp3', 'track1.mp3', 'song1.mp3', 'audio.mp3'];
                    for (const testFile of commonFiles) {
                        try {
                            const response = await fetch(`music/${encodeURIComponent(folderName)}/${testFile}`, { 
                                method: 'HEAD',
                                cache: 'no-cache'
                            });
                            if (response.status === 200) {
                                foundFolders.push(folderName);
                                break;
                            }
                        } catch (error) {
                            continue;
                        }
                    }
                    
                } catch (error) {
                    // Folder doesn't exist or isn't accessible
                    continue;
                }
                
                // Limit discovery to prevent performance issues
                if (foundFolders.length >= 20) {
                    console.log('Found 20 playlists, stopping discovery for performance');
                    break;
                }
            }
            
            console.log(`Discovered ${foundFolders.length} playlist folders:`, foundFolders);
            return foundFolders;
        }

        // Function to automatically detect MP3 files in a playlist folder
        async function loadPlaylistSongs(playlistName) {
            const detectedSongs = [];
            
            // We'll try a range of common filename patterns and test if they exist
            const patterns = [
                // Try numbered patterns first
                ...Array.from({length: 200}, (_, i) => `${String(i + 1).padStart(2, '0')}.mp3`), // 01.mp3, 02.mp3, etc.
                ...Array.from({length: 100}, (_, i) => `${i + 1}.mp3`), // 1.mp3, 2.mp3, etc.
                ...Array.from({length: 100}, (_, i) => `track${String(i + 1).padStart(2, '0')}.mp3`), // track01.mp3, etc.
                ...Array.from({length: 100}, (_, i) => `track${i + 1}.mp3`), // track1.mp3, etc.
                ...Array.from({length: 100}, (_, i) => `song${String(i + 1).padStart(2, '0')}.mp3`), // song01.mp3, etc.
                ...Array.from({length: 100}, (_, i) => `song${i + 1}.mp3`), // song1.mp3, etc.
                
                // Try alphabet patterns
                ...Array.from({length: 26}, (_, i) => `${String.fromCharCode(97 + i)}.mp3`), // a.mp3, b.mp3, etc.
                
                // Try some common naming conventions
                'audio.mp3', 'music.mp3', 'sound.mp3',
                
                // For specific playlists, try artist-specific patterns
                ...(playlistName.includes('peep') || playlistName.includes('Xxxtentacion') ? [
                    'lil_peep.mp3', 'xxx.mp3', 'xxxtentacion.mp3', 'peep.mp3',
                    ...Array.from({length: 50}, (_, i) => `lil_peep_${i + 1}.mp3`),
                    ...Array.from({length: 50}, (_, i) => `xxx_${i + 1}.mp3`),
                    ...Array.from({length: 50}, (_, i) => `xxxtentacion_${i + 1}.mp3`),
                ] : []),
                
                // Try common single-letter + number patterns
                ...Array.from({length: 100}, (_, i) => `a${i + 1}.mp3`),
                ...Array.from({length: 100}, (_, i) => `b${i + 1}.mp3`),
                ...Array.from({length: 100}, (_, i) => `c${i + 1}.mp3`),
            ];
            
            // Test each pattern to see if the file exists
            for (const filename of patterns) {
                try {
                    const response = await fetch(`music/${encodeURIComponent(playlistName)}/${encodeURIComponent(filename)}`, { 
                        method: 'HEAD',
                        cache: 'no-cache'
                    });
                    
                    if (response.ok) {
                        detectedSongs.push(filename);
                        
                        // If we find a lot of songs quickly, we can break early for performance
                        if (detectedSongs.length >= 500) {
                            console.log(`Found ${detectedSongs.length} songs, stopping scan for performance`);
                            break;
                        }
                    }
                } catch (error) {
                    // File doesn't exist, continue to next pattern
                    continue;
                }
                
                // Small delay every 20 requests to prevent overwhelming the server
                if (patterns.indexOf(filename) % 20 === 0) {
                    await new Promise(resolve => setTimeout(resolve, 10));
                }
            }
            
            console.log(`Auto-detected ${detectedSongs.length} songs in "${playlistName}"`);
            return detectedSongs;
        }

        // Initialize starfield
        function createStarfield() {
            const starfield = document.getElementById('starfield');
            
            // Create stars
            for (let i = 0; i < 100; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                star.style.width = Math.random() * 3 + 1 + 'px';
                star.style.height = star.style.width;
                star.style.animationDelay = Math.random() * 3 + 's';
                starfield.appendChild(star);
            }
            
            // Create constellation points and lines
            for (let i = 0; i < 20; i++) {
                const constellation = document.createElement('div');
                constellation.className = 'constellation';
                constellation.style.left = Math.random() * 100 + '%';
                constellation.style.top = Math.random() * 100 + '%';
                starfield.appendChild(constellation);
                
                if (i % 3 === 0) {
                    const line = document.createElement('div');
                    line.className = 'constellation-line';
                    line.style.left = Math.random() * 100 + '%';
                    line.style.top = Math.random() * 100 + '%';
                    line.style.width = Math.random() * 100 + 50 + 'px';
                    line.style.transform = `rotate(${Math.random() * 360}deg)`;
                    line.style.animationDelay = Math.random() * 4 + 's';
                    starfield.appendChild(line);
                }
            }
        }

        // Load playlist
        async function loadPlaylist(playlistName) {
            currentPlaylistName = playlistName;
            
            // Show loading state
            currentPlaylistNameEl.textContent = `üåü Scanning ${playlistName}...`;
            songItems.innerHTML = `
                <div style="text-align: center; padding: 40px; color: #4a9eff;">
                    <div style="font-size: 2rem; margin-bottom: 15px;">üîç</div>
                    <div style="margin-bottom: 10px;">Auto-detecting your songs...</div>
                    <div style="font-size: 0.9rem; color: rgba(255,255,255,0.6);">This may take a moment for large collections</div>
                </div>
            `;
            songList.classList.remove('hidden');
            
            try {
                // Auto-detect songs in the playlist folder
                const songs = await loadPlaylistSongs(playlistName);
                
                if (songs.length === 0) {
                    songItems.innerHTML = `
                        <div style="text-align: center; padding: 40px; color: #ff6b6b;">
                            <div style="font-size: 2rem; margin-bottom: 15px;">üòï</div>
                            <p style="margin-bottom: 10px;">No MP3 files found in this playlist</p>
                            <div style="font-size: 0.9rem; color: rgba(255,255,255,0.6);">
                                <p>Make sure your MP3 files are in:</p>
                                <p><code>music/${playlistName}/</code></p>
                                <p style="margin-top: 10px;">Try naming them: 1.mp3, 2.mp3, track1.mp3, etc.</p>
                            </div>
                        </div>
                    `;
                    currentPlaylistNameEl.textContent = playlistName;
                    return;
                }
                
                discoveredPlaylists[playlistName] = songs;
                originalPlaylist = [...songs];
                currentPlaylist = [...originalPlaylist];
                currentSongIndex = 0;
                
                // Update UI
                currentPlaylistNameEl.textContent = playlistName;
                displaySongList();
                loadSong(currentSongIndex);
                
                // Show success message briefly
                const successMsg = document.createElement('div');
                successMsg.style.cssText = `
                    position: fixed; top: 20px; right: 20px; z-index: 1000;
                    background: rgba(74, 158, 255, 0.9); color: white; padding: 15px 20px;
                    border-radius: 8px; backdrop-filter: blur(10px);
                    animation: slideIn 0.3s ease;
                `;
                successMsg.innerHTML = `‚úÖ Found ${songs.length} songs!`;
                document.body.appendChild(successMsg);
                
                setTimeout(() => {
                    successMsg.remove();
                }, 3000);
                
            } catch (error) {
                console.error('Error loading playlist:', error);
                songItems.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #ff6b6b;">
                        <div style="font-size: 2rem; margin-bottom: 15px;">‚ùå</div>
                        <p style="margin-bottom: 10px;">Error scanning playlist</p>
                        <div style="font-size: 0.9rem; color: rgba(255,255,255,0.6);">
                            <p>Check browser console for details</p>
                            <p>Make sure files are accessible via HTTP</p>
                        </div>
                    </div>
                `;
                currentPlaylistNameEl.textContent = playlistName;
            }
        }

        // Display song list
        function displaySongList() {
            songList.classList.remove('hidden');
            document.getElementById('currentPlaylistTitle').textContent = `${currentPlaylistName} (${currentPlaylist.length} songs)`;
            
            songItems.innerHTML = '';
            currentPlaylist.forEach((song, index) => {
                const songItem = document.createElement('div');
                songItem.className = 'song-item';
                
                // Clean up song name for display
                let displayName = song.replace('.mp3', '');
                displayName = displayName.replace(/[_-]/g, ' ');
                displayName = displayName.replace(/\b\w/g, l => l.toUpperCase());
                
                // Try to extract artist from filename (common patterns)
                let artistName = 'Unknown Artist';
                let songTitle = displayName;
                
                // Common patterns: "Artist - Song", "Artist_Song", etc.
                if (displayName.includes(' - ')) {
                    const parts = displayName.split(' - ');
                    artistName = parts[0].trim();
                    songTitle = parts.slice(1).join(' - ').trim();
                } else if (displayName.includes('_')) {
                    const parts = displayName.split('_');
                    if (parts.length >= 2) {
                        artistName = parts[0].trim();
                        songTitle = parts.slice(1).join(' ').trim();
                    }
                }
                
                songItem.innerHTML = `
                    <div class="song-info">
                        <div class="song-name">${songTitle}</div>
                        <div class="song-artist">${artistName}</div>
                    </div>
                    <span class="song-duration">--:--</span>
                `;
                
                songItem.addEventListener('click', () => {
                    currentSongIndex = index;
                    loadSong(currentSongIndex);
                    play();
                });
                
                // Double-click to play immediately
                songItem.addEventListener('dblclick', () => {
                    currentSongIndex = index;
                    loadSong(currentSongIndex);
                    play();
                });
                
                songItems.appendChild(songItem);
            });
        }

        // Load song
        function loadSong(index) {
            if (currentPlaylist.length === 0) return;
            
            const song = currentPlaylist[index];
            audioPlayer.src = `music/${currentPlaylistName}/${song}`;
            
            // Clean up song name for display
            let displayName = song.replace('.mp3', '');
            displayName = displayName.replace(/[_-]/g, ' ');
            displayName = displayName.replace(/\b\w/g, l => l.toUpperCase());
            
            currentSongTitle.textContent = displayName;
            
            // Update active song in list
            document.querySelectorAll('.song-item').forEach((item, i) => {
                item.classList.toggle('active', i === index);
            });
        }

        // Play/Pause functions
        function play() {
            audioPlayer.play();
            isPlaying = true;
            playPauseIcon.className = 'btn-icon pause-icon';
        }

        function pause() {
            audioPlayer.pause();
            isPlaying = false;
            playPauseIcon.className = 'btn-icon play-icon';
        }

        function togglePlayPause() {
            if (isPlaying) {
                pause();
            } else {
                play();
            }
        }

        // Next/Previous functions
        function nextSong() {
            currentSongIndex = (currentSongIndex + 1) % currentPlaylist.length;
            loadSong(currentSongIndex);
            if (isPlaying) play();
        }

        function prevSong() {
            currentSongIndex = (currentSongIndex - 1 + currentPlaylist.length) % currentPlaylist.length;
            loadSong(currentSongIndex);
            if (isPlaying) play();
        }

        // Shuffle function
        function toggleShuffle() {
            isShuffled = !isShuffled;
            shuffleBtn.classList.toggle('active', isShuffled);
            
            if (isShuffled) {
                // Shuffle the playlist
                const currentSong = currentPlaylist[currentSongIndex];
                currentPlaylist = [...originalPlaylist].sort(() => Math.random() - 0.5);
                currentSongIndex = currentPlaylist.indexOf(currentSong);
            } else {
                // Restore original order
                const currentSong = currentPlaylist[currentSongIndex];
                currentPlaylist = [...originalPlaylist];
                currentSongIndex = currentPlaylist.indexOf(currentSong);
            }
            displaySongList();
        }

        // Format time
        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }

        // Search function
        function searchSongs(query) {
            const songElements = document.querySelectorAll('.song-item');
            songElements.forEach(item => {
                const songName = item.querySelector('.song-name').textContent.toLowerCase();
                const artistName = item.querySelector('.song-artist').textContent.toLowerCase();
                const match = songName.includes(query.toLowerCase()) || artistName.includes(query.toLowerCase());
                item.style.display = match ? 'flex' : 'none';
            });
            
            // Scroll to top of results
            if (query) {
                songList.scrollTop = 0;
            }
        }

        // Function to display discovered playlists
        function displayPlaylists(playlists) {
            const playlistsContainer = document.getElementById('playlists');
            playlistsContainer.innerHTML = '';
            
            if (playlists.length === 0) {
                playlistsContainer.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #ff6b6b; grid-column: 1 / -1;">
                        <div style="font-size: 2rem; margin-bottom: 15px;">üìÅ</div>
                        <p style="margin-bottom: 10px;">No playlist folders found</p>
                        <div style="font-size: 0.9rem; color: rgba(255,255,255,0.6);">
                            <p>Create folders in your music directory:</p>
                            <p><code>music/Your Playlist Name/</code></p>
                            <p>Then add MP3 files inside!</p>
                        </div>
                    </div>
                `;
                return;
            }
            
            playlists.forEach(playlistName => {
                const playlistCard = document.createElement('div');
                playlistCard.className = 'playlist-card';
                playlistCard.setAttribute('data-playlist', playlistName);
                
                // Generate emoji based on playlist name
                let emoji = 'üéµ';
                const name = playlistName.toLowerCase();
                if (name.includes('sleep') || name.includes('chill') || name.includes('relax')) emoji = 'üò¥';
                else if (name.includes('peep') || name.includes('xxx') || name.includes('rap') || name.includes('hip')) emoji = 'üé§';
                else if (name.includes('liked') || name.includes('favorite')) emoji = '‚ù§Ô∏è';
                else if (name.includes('party') || name.includes('dance')) emoji = 'üéâ';
                else if (name.includes('workout') || name.includes('gym')) emoji = 'üí™';
                else if (name.includes('study') || name.includes('focus')) emoji = 'üìö';
                else if (name.includes('rock') || name.includes('metal')) emoji = 'ü§ò';
                else if (name.includes('pop')) emoji = '‚≠ê';
                else if (name.includes('electronic') || name.includes('house')) emoji = 'üîä';
                
                playlistCard.innerHTML = `
                    <div class="playlist-title">${emoji} ${playlistName}</div>
                    <p>Auto-discovered playlist</p>
                `;
                
                playlistCard.addEventListener('click', () => {
                    loadPlaylist(playlistName);
                });
                
                playlistsContainer.appendChild(playlistCard);
            });
        }
        
        // Initialize the app by discovering playlists
        async function initializeApp() {
            const playlistsContainer = document.getElementById('playlists');
            playlistsContainer.innerHTML = `
                <div style="text-align: center; padding: 40px; color: #4a9eff; grid-column: 1 / -1;">
                    <div style="font-size: 2rem; margin-bottom: 15px;">üîç</div>
                    <div style="margin-bottom: 10px;">Discovering your playlists...</div>
                    <div style="font-size: 0.9rem; color: rgba(255,255,255,0.6);">Scanning music folder for playlists</div>
                </div>
            `;
            
            try {
                const foundPlaylists = await discoverPlaylistFolders();
                discoveredPlaylists = foundPlaylists.reduce((acc, name) => {
                    acc[name] = [];
                    return acc;
                }, {});
                
                displayPlaylists(foundPlaylists);
                
                // Show success message
                if (foundPlaylists.length > 0) {
                    const successMsg = document.createElement('div');
                    successMsg.style.cssText = `
                        position: fixed; top: 20px; right: 20px; z-index: 1000;
                        background: rgba(74, 158, 255, 0.9); color: white; padding: 15px 20px;
                        border-radius: 8px; backdrop-filter: blur(10px);
                        animation: slideIn 0.3s ease;
                    `;
                    successMsg.innerHTML = `üéµ Found ${foundPlaylists.length} playlists!`;
                    document.body.appendChild(successMsg);
                    
                    setTimeout(() => {
                        successMsg.remove();
                    }, 3000);
                }
                
            } catch (error) {
                console.error('Error discovering playlists:', error);
                playlistsContainer.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #ff6b6b; grid-column: 1 / -1;">
                        <div style="font-size: 2rem; margin-bottom: 15px;">‚ùå</div>
                        <p style="margin-bottom: 10px;">Error discovering playlists</p>
                        <div style="font-size: 0.9rem; color: rgba(255,255,255,0.6);">
                            Check browser console for details
                        </div>
                    </div>
                `;
            }
        }

        playPauseBtn.addEventListener('click', togglePlayPause);
        nextBtn.addEventListener('click', nextSong);
        prevBtn.addEventListener('click', prevSong);
        shuffleBtn.addEventListener('click', toggleShuffle);

        // Progress bar click
        progressBar.addEventListener('click', (e) => {
            const rect = progressBar.getBoundingClientRect();
            const percent = (e.clientX - rect.left) / rect.width;
            audioPlayer.currentTime = percent * audioPlayer.duration;
        });

        // Volume control
        volumeSlider.addEventListener('input', (e) => {
            audioPlayer.volume = e.target.value / 100;
        });

        // Search input
        searchInput.addEventListener('input', (e) => {
            searchSongs(e.target.value);
        });

        // Audio player events
        audioPlayer.addEventListener('loadedmetadata', () => {
            totalTime.textContent = formatTime(audioPlayer.duration);
            
            // Update duration in the song list
            const activeSongItem = document.querySelector('.song-item.active .song-duration');
            if (activeSongItem) {
                activeSongItem.textContent = formatTime(audioPlayer.duration);
            }
        });

        audioPlayer.addEventListener('timeupdate', () => {
            if (audioPlayer.duration) {
                const percent = (audioPlayer.currentTime / audioPlayer.duration) * 100;
                progressFill.style.width = percent + '%';
                currentTime.textContent = formatTime(audioPlayer.currentTime);
            }
        });

        audioPlayer.addEventListener('ended', nextSong);

        // Initialize
        createStarfield();
        initializeApp(); // Start playlist discovery
        
        console.log('üåü Music Player loaded! üåü');
        console.log('üéµ FULLY AUTOMATIC DETECTION ENABLED! üéµ');
        console.log('');
        console.log('üìÅ The player will automatically discover:');
        console.log('   ‚úÖ Any folders in your music/ directory');
        console.log('   ‚úÖ All MP3 files in those folders');
        console.log('');
        console.log('üí° Just create folders like:');
        console.log('   üìÅ music/My Favorite Songs/');
        console.log('   üìÅ music/Hip Hop/');
        console.log('   üìÅ music/Chill Vibes/');
        console.log('   üìÅ music/Artist Name/');
        console.log('');
        console.log('üé∂ Add MP3 files and they\'ll be found automatically!');
        console.log('   üí° Best naming: 1.mp3, 2.mp3, 3.mp3...');
    </script>
</body>
</html>